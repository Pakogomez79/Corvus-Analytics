{% extends "layout.html" %}

{% block title %}Entidades - Corvus International Group{% endblock %}
{% block page_title %}Entidades Registradas{% endblock %}

{% block breadcrumb %}
{{ self.page_title() }}
{% endblock %}

{% block content %}

<!-- Controles y tabla: eliminada la tarjeta de estad√≠sticas -->
<div class="card">
  <div class="card-header">
    <div>
      <h3 class="card-title">Listado de Entidades</h3>
      <p class="card-subtitle">Entidades registradas</p>
    </div>
    <div style="display:flex; gap:1rem; align-items:center;">
      <form method="get" action="/entidades" style="display:flex; gap:0.75rem; align-items:center;">
        <input type="search" name="q" placeholder="Buscar nombre o NIT" value="{{ q or '' }}" style="padding:0.5rem 0.75rem; border:1px solid #e2e8f0; border-radius:6px;" />
        <select name="active" style="padding:0.5rem 0.75rem; border:1px solid #e2e8f0; border-radius:6px;">
          <option value="" {% if active is none or active=='' %}selected{% endif %}>Todos</option>
          <option value="1" {% if active=='1' or active=='true' %}selected{% endif %}>Activas</option>
          <option value="0" {% if active=='0' or active=='false' %}selected{% endif %}>Inactivas</option>
        </select>
        <button class="btn btn-secondary" type="submit">Buscar</button>
      </form>

      <a href="/entidades/create" class="btn btn-accent">Nueva Entidad</a>
    </div>
  </div>

  <div class="card-body" style="padding: 0;">
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Tipo</th>
            <th>C√≥digo</th>
            <th>Nombre</th>
            <th>Denominaci√≥n abreviada</th>
            <th>Delegatura competente</th>
            <th>Identificador (NIT/RUC)</th>
            <th>Sector</th>
            <th style="text-align: center;">Archivos</th>
            <th style="text-align: center;">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% if entities %}
            {% for entity in entities %}
            <tr>
              <td>{{ entity.id }}</td>
              <td>{{ entity.entity_type or '' }}</td>
              <td>{{ entity.code or '' }}</td>
              <td>
                <span style="font-weight: 500;">{{ entity.name }}</span>
              </td>
              <td>{{ entity.short_name or '' }}</td>
              <td>{{ entity.delegatura or '' }}</td>
              <td>
                <code style="font-size: 0.85rem; background: var(--corvus-bg-dark); padding: 0.15rem 0.5rem; border-radius: 4px;">
                  {{ entity.nit or '' }}
                </code>
              </td>
              <td>{{ entity.sector or 'N/A' }}</td>
              <td style="text-align: center;">
                <span class="badge" style="background: var(--corvus-accent); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">
                  {{ entity.files|length if entity.files else 0 }}
                </span>
              </td>
              <td style="text-align: center; display:flex; gap:0.5rem; justify-content:center;">
                  <a href="/entidades/{{ entity.id }}/edit" title="Editar" style="display:inline-flex; align-items:center; padding:0.25rem;">‚úèÔ∏è</a>
                  <form method="post" action="/entidades/{{ entity.id }}/delete" style="display:inline;" onsubmit="return confirm('¬øInactivar esta entidad?');">
                    <button type="submit" class="btn btn-outline" style="padding:0.25rem 0.5rem;">üóëÔ∏è</button>
                  </form>
                  <a href="/archivos?entidad={{ entity.name }}" class="btn btn-secondary" style="font-size:0.75rem; padding:0.25rem 0.5rem;">Ver Archivos</a>
                </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="10" style="text-align: center; padding: 3rem;">
                <div style="color: var(--corvus-text-muted);">
                  <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" style="margin-bottom: 1rem; opacity: 0.5;">
                    <path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                  </svg>
                  <p style="margin: 0; font-size: 1.1rem;">No hay entidades registradas</p>
                  <p style="margin: 0.5rem 0 0; font-size: 0.9rem;">
                    <a href="/upload">Carga un archivo XBRL</a> para registrar una entidad autom√°ticamente
                  </p>
                </div>
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}
