{% extends "layout.html" %}

{% block title %}Comparativos - Corvus XBRL{% endblock %}
{% block page_title %}Comparativos Financieros{% endblock %}

{% block breadcrumb %}
<a href="/">Inicio</a> / <a href="/comparativos">Reportes</a> / <span>Comparativos</span>
{% endblock %}

{% block content %}
<!-- Filtros -->
<div class="card" style="margin-bottom: 1.5rem;">
  <div class="card-header">
    <h3 class="card-title">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5rem;">
        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
      </svg>
      Filtros de Búsqueda
    </h3>
  </div>
  <div class="card-body">
    <form method="get" action="/comparativos" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:1rem; align-items: end;">
      <div class="form-group">
        <label class="form-label">Entidad</label>
        <input type="search" class="form-control" name="entidad" 
               value="{{ request.query_params.get('entidad', '') }}" 
               placeholder="Nombre de la entidad" />
      </div>
      <div class="form-group">
        <label class="form-label">Concepto</label>
        <input type="search" class="form-control" name="concepto" 
               value="{{ request.query_params.get('concepto', '') }}" 
               placeholder="Concepto o canonical" />
      </div>
      <div class="form-group">
        <label class="form-label">Desde</label>
        <input type="date" class="form-control" name="period_start" 
               value="{{ request.query_params.get('period_start', '') }}" />
      </div>
      <div class="form-group">
        <label class="form-label">Hasta</label>
        <input type="date" class="form-control" name="period_end" 
               value="{{ request.query_params.get('period_end', '') }}" />
      </div>
      <div class="form-group" style="display:flex; gap:0.5rem;">
        <button type="submit" class="btn btn-primary">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.25rem;">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
          Filtrar
        </button>
        <a href="/comparativos" class="btn btn-outline">Limpiar</a>
      </div>
    </form>
  </div>
</div>

<!-- Exportaciones -->
<div class="card" style="margin-bottom: 1.5rem;">
  <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
    <h3 class="card-title">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5rem;">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
        <polyline points="10 9 9 9 8 9"></polyline>
      </svg>
      Resultados ({{ rows|length }} registros)
    </h3>
    <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
      {% set query = request.url.query %}
      <a href="/export/csv{% if query %}?{{ query }}{% endif %}" class="btn btn-success" style="font-size: 0.85rem;">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.25rem;">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        CSV
      </a>
      <a href="/export/xlsx{% if query %}?{{ query }}{% endif %}" class="btn btn-primary" style="font-size: 0.85rem;">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.25rem;">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        Excel
      </a>
      <a href="/export/pdf{% if query %}?{{ query }}{% endif %}" class="btn btn-danger" style="font-size: 0.85rem;">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.25rem;">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        PDF
      </a>
    </div>
  </div>
  <div class="card-body" style="padding: 0;">
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>Entidad</th>
            <th>Periodo</th>
            <th>Concepto</th>
            <th style="text-align: right;">Valor</th>
            <th>Moneda</th>
          </tr>
        </thead>
        <tbody>
          {% if rows %}
            {% for row in rows %}
            <tr>
              <td>
                <span style="font-weight: 500;">{{ row.entidad }}</span>
              </td>
              <td>{{ row.periodo }}</td>
              <td>
                <code style="font-size: 0.85rem; background: var(--corvus-bg-dark); padding: 0.15rem 0.5rem; border-radius: 4px;">
                  {{ row.concepto }}
                </code>
              </td>
              <td style="text-align: right; font-family: 'Roboto Mono', monospace; font-weight: 500;">
                {{ "{:,.0f}".format(row.valor) }}
              </td>
              <td>
                <span class="badge" style="background: var(--corvus-accent); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">
                  {{ row.moneda }}
                </span>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="5" style="text-align: center; padding: 3rem;">
                <div style="color: var(--corvus-text-muted);">
                  <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" style="margin-bottom: 1rem; opacity: 0.5;">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                  </svg>
                  <p style="margin: 0; font-size: 1.1rem;">No se encontraron resultados</p>
                  <p style="margin: 0.5rem 0 0; font-size: 0.9rem;">Intenta ajustar los filtros de búsqueda o <a href="/upload">cargar un archivo XBRL</a></p>
                </div>
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
