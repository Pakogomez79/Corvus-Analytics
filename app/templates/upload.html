{% extends "layout.html" %}

{% block title %}Cargar XBRL - Corvus International Group{% endblock %}
{% block page_title %}Cargar Archivo XBRL{% endblock %}
{% block breadcrumb %}XBRL &gt; Cargar Archivo{% endblock %}

{% block content %}
<div class="card" style="max-width: 800px;">
  <div class="card-header">
    <div>
      <h3 class="card-title">Subir Archivo XBRL</h3>
      <p class="card-subtitle">Formatos aceptados: .xbrl, .xml</p>
    </div>
  </div>
  
  <form 
    hx-post="/upload-xbrl" 
    hx-target="#upload-result" 
    hx-swap="innerHTML" 
    hx-encoding="multipart/form-data"
    hx-indicator="#upload-spinner"
    x-data="{ fileName: '', isDragging: false }"
  >
    <!-- Drop Zone -->
    <div 
      class="upload-dropzone"
      :class="{ 'dragging': isDragging }"
      @dragover.prevent="isDragging = true"
      @dragleave.prevent="isDragging = false"
      @drop.prevent="isDragging = false; fileName = $event.dataTransfer.files[0]?.name || ''"
      style="
        border: 2px dashed #e2e8f0;
        border-radius: var(--radius-lg);
        padding: 3rem 2rem;
        text-align: center;
        background: var(--bg-main);
        transition: all 0.2s;
        cursor: pointer;
        margin-bottom: 1.5rem;
      "
      @click="$refs.fileInput.click()"
    >
      <input 
        type="file" 
        id="xbrl" 
        name="xbrl" 
        accept=".xbrl,.xml" 
        required 
        x-ref="fileInput"
        @change="fileName = $event.target.files[0]?.name || ''"
        style="display: none;"
      />
      
      <div style="margin-bottom: 1rem;">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: var(--corvus-accent); margin: 0 auto;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
        </svg>
      </div>
      
      <template x-if="!fileName">
        <div>
          <p style="font-size: 1rem; color: var(--text-primary); margin-bottom: 0.5rem;">
            Arrastra tu archivo aquí o <span style="color: var(--corvus-accent); font-weight: 500;">haz clic para seleccionar</span>
          </p>
          <p style="font-size: 0.8125rem; color: var(--text-secondary);">
            Archivos XBRL de taxonomía SFC (máximo 50MB)
          </p>
        </div>
      </template>
      
      <template x-if="fileName">
        <div>
          <p style="font-size: 1rem; color: var(--corvus-primary); font-weight: 500;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="vertical-align: middle; margin-right: 0.5rem;">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <span x-text="fileName"></span>
          </p>
          <p style="font-size: 0.8125rem; color: var(--text-secondary); margin-top: 0.5rem;">
            Haz clic para cambiar archivo
          </p>
        </div>
      </template>
    </div>
    
    <div style="display: flex; gap: 1rem; align-items: center;">
      <button type="submit" class="btn btn-primary">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
        </svg>
        Subir y Procesar
      </button>
      
      <div id="upload-spinner" class="htmx-indicator" style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-secondary);">
        <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="animation: spin 1s linear infinite;">
          <style>@keyframes spin { to { transform: rotate(360deg); } }</style>
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="31.4 31.4" stroke-linecap="round"/>
        </svg>
        Procesando archivo...
      </div>
    </div>
  </form>
  
  <!-- Result Container -->
  <div id="upload-result" style="margin-top: 1.5rem;"></div>
</div>

<!-- Info Card -->
<div class="card" style="max-width: 800px; margin-top: 1.5rem;">
  <div class="card-header">
    <h3 class="card-title">Información del Proceso</h3>
  </div>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
    <div>
      <h4 style="font-size: 0.875rem; color: var(--corvus-primary); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        Validación
      </h4>
      <p style="font-size: 0.8125rem; color: var(--text-secondary);">
        El archivo se valida contra la taxonomía SFC para asegurar integridad.
      </p>
    </div>
    <div>
      <h4 style="font-size: 0.875rem; color: var(--corvus-primary); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4" />
        </svg>
        Almacenamiento
      </h4>
      <p style="font-size: 0.8125rem; color: var(--text-secondary);">
        Los hechos se almacenan con mapeo canónico para comparativos.
      </p>
    </div>
    <div>
      <h4 style="font-size: 0.875rem; color: var(--corvus-primary); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
        </svg>
        Alertas
      </h4>
      <p style="font-size: 0.8125rem; color: var(--text-secondary);">
        Se generan alertas automáticas según las reglas configuradas.
      </p>
    </div>
  </div>
</div>

<style>
  .upload-dropzone:hover,
  .upload-dropzone.dragging {
    border-color: var(--corvus-accent) !important;
    background: rgba(0, 188, 212, 0.05) !important;
  }
</style>
{% endblock %}
