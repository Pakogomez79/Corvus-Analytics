{% extends "layout.html" %}

{% block title %}Archivos XBRL - Corvus XBRL{% endblock %}
{% block page_title %}Archivos XBRL{% endblock %}

{% block breadcrumb %}
<a href="/">Inicio</a> / <a href="/archivos">XBRL</a> / <span>Archivos</span>
{% endblock %}

{% block content %}
<!-- Estadísticas -->
<div class="stats-grid" style="margin-bottom: 1.5rem;">
  <div class="stat-card">
    <div class="stat-icon" style="background: linear-gradient(135deg, var(--info), #63b3ed);">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/>
      </svg>
    </div>
    <div class="stat-content">
      <div class="stat-value">{{ archivos|length }}</div>
      <div class="stat-label">Total Archivos</div>
    </div>
  </div>
</div>

<!-- Tabla de Archivos -->
<div class="card">
  <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
    <h3 class="card-title">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
        <path d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/>
      </svg>
      Listado de Archivos XBRL
    </h3>
    <a href="/upload" class="btn btn-primary" style="font-size: 0.85rem;">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="17 8 12 3 7 8"></polyline>
        <line x1="12" y1="3" x2="12" y2="15"></line>
      </svg>
      Cargar Archivo
    </a>
  </div>
  <div class="card-body" style="padding: 0;">
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Entidad</th>
            <th>Taxonomía</th>
            <th>Periodo</th>
            <th style="text-align: right;">Hechos</th>
            <th>Fecha Carga</th>
            <th style="text-align: center;">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% if archivos %}
            {% for archivo in archivos %}
            <tr>
              <td>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--corvus-accent)" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                  </svg>
                  <span style="font-weight: 500;">{{ archivo.filename }}</span>
                </div>
              </td>
              <td>{{ archivo.entity.name if archivo.entity else 'N/A' }}</td>
              <td>
                <code style="font-size: 0.8rem; background: var(--corvus-bg-dark); padding: 0.15rem 0.5rem; border-radius: 4px;">
                  {{ archivo.taxonomy or 'N/A' }}
                </code>
              </td>
              <td>
                {% if archivo.period_start and archivo.period_end %}
                  {{ archivo.period_start.strftime('%Y-%m-%d') }} - {{ archivo.period_end.strftime('%Y-%m-%d') }}
                {% else %}
                  N/A
                {% endif %}
              </td>
              <td style="text-align: right; font-family: 'Roboto Mono', monospace;">
                <span class="badge" style="background: var(--success); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">
                  {{ archivo.facts|length if archivo.facts else 0 }}
                </span>
              </td>
              <td style="font-size: 0.85rem; color: var(--text-secondary);">
                {{ archivo.created_at.strftime('%Y-%m-%d %H:%M') if archivo.created_at else 'N/A' }}
              </td>
              <td style="text-align: center;">
                <a href="/comparativos?entidad={{ archivo.entity.name if archivo.entity else '' }}" 
                   class="btn btn-secondary" 
                   style="font-size: 0.75rem; padding: 0.35rem 0.75rem;">
                  Ver Hechos
                </a>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="7" style="text-align: center; padding: 3rem;">
                <div style="color: var(--corvus-text-muted);">
                  <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" style="margin-bottom: 1rem; opacity: 0.5;">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                  </svg>
                  <p style="margin: 0; font-size: 1.1rem;">No hay archivos cargados</p>
                  <p style="margin: 0.5rem 0 0; font-size: 0.9rem;">
                    <a href="/upload">Carga tu primer archivo XBRL</a> para comenzar
                  </p>
                </div>
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
